(this.webpackJsonpemilus=this.webpackJsonpemilus||[]).push([[8],{377:function(e,t,c){},469:function(e,t,c){"use strict";c.r(t);var n=c(63),s=c(0),a=c(37),r=c(23),o=(c(377),c(33)),i=c(107),l=c(332),d=c(335),u={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},j=c(10),b=function(e,t){return s.createElement(j.a,Object.assign({},e,{ref:t,icon:u}))};b.displayName="SmileOutlined";var f=s.forwardRef(b),h=c(3),m=["\u2764","\ud83d\ude02","\ud83d\ude2e","\ud83d\ude1e","\ud83d\ude21","\ud83d\udc4d","\ud83d\udc4e"],O=function(e){var t=Object(r.c)(),c=Object(r.d)((function(e){return{userInfo:e.auth.userInfo,currentChat:e.chatReducer.currentChat}})),n=c.userInfo,s=c.currentChat,o=function(c){c.item;var r=c.key,o={user:n._id,reaction:r},l=Object(i.a)(e.message.reactions),d=l.findIndex((function(e){return e.user===n._id||e.user._id===n._id}));console.log("Select: ",d),d>=0?l[d]=o:l.unshift(o),a.a.emitReactMessage({messageId:e.message._id,chatId:s._id,reactions:l}),a.a.onReactMessage((function(e){t(e)}))};return Object(h.jsx)(d.a,{overlay:function(){return Object(h.jsx)(l.a,{onClick:o,className:"d-flex flex-row pl-2 pr-2",style:{borderRadius:50},children:m.map((function(e,t){return Object(h.jsx)(l.a.Item,{className:"p-2",children:Object(h.jsx)("h2",{className:"mb-0",children:e})},e)}))})},trigger:["click"],children:Object(h.jsx)(f,{className:"align-self-center ".concat(e.isSender?"mr-2":"ml-2")})})},g=c(7),v=function(e){var t,c=e.isSender?{right:"75%"}:{left:"75%"};return Object(h.jsx)(h.Fragment,{children:e.reactions&&(null===(t=e.reactions)||void 0===t?void 0:t.length)>0&&Object(h.jsxs)("div",{className:"reaction-container d-flex ".concat(e.isSender?"flex-row":"flex-row-reverse"," align-items-center"),style:Object(g.a)({height:"fit-content",width:"fit-content",backgroundColor:"#fff",alignSelf:"flex-end",position:"absolute",borderRadius:100,padding:"1px 2px",bottom:-16},c),onClick:e.showModal,children:[e.reactions.slice(0,3).map((function(e){return e.reaction})).map((function(e,t){return Object(h.jsx)("h5",{className:"mb-0",children:e},t)})),Object(h.jsx)("h6",{className:"mb-0 mr-1 ml-1",children:"".concat(e.reactions.length>3?"+":""," ").concat(e.reactions.length)})]})})},x=c(48),p=c(354),S=function(e){var t=Object(r.c)();return Object(h.jsx)(p.a,{onClick:function(){t(Object(x.h)(e.message))},className:"align-self-center ".concat(e.isSender?"mr-2":"ml-2")})},w=c(331),C=c(80),M=function(e){var t,c=e.isSender,a=e.messageInfo,r=e.startSequence,i=e.endSequence,l=e.showTimestamp,d=e.showModal,u=e.showReply,j=e.showAvatar,b=o.a.formatDate(a.createdAt)+" "+o.a.formatTime(a.createdAt),f=Object(s.useState)(!1),m=Object(n.a)(f,2),g=m[0],x=m[1];return Object(h.jsxs)("div",{onMouseOver:function(){x(!0)},onMouseLeave:function(){x(!1)},className:["message","".concat(c?"mine":""),"".concat(r||u?"start":""),"".concat(i||u?"end":""),"".concat(j&&!i?"avatar-shown":""),"".concat(a.reactions&&(null===(t=a.reactions)||void 0===t?void 0:t.length)>0?"mb-3":"")].join(" "),children:[l&&Object(h.jsx)("div",{className:"timestamp",children:b}),u&&Object(h.jsx)("div",{className:"reply-container",children:Object(h.jsx)("div",{className:"reply",children:a.repliesTo.message})}),Object(h.jsxs)("div",{className:"bubble-container ".concat(c&&"flex-row-reverse"," ").concat(u&&"has-reply"),children:[j&&!0===i&&Object(h.jsx)(w.a,{className:"mr-2",src:C.a.API_ENDPOINT_URL+"/"+a.sender.avatar.url}),Object(h.jsxs)("div",{className:"bubble",children:[a.message,Object(h.jsx)(v,{isSender:c,reactions:a.reactions,showModal:d})]}),g&&Object(h.jsx)(O,{message:a,isSender:c}),g&&Object(h.jsx)(S,{message:a,isSender:c})]})]})},N=c(213),_=c(90),I=function(){return Object(h.jsx)(N.a,{indicator:Object(h.jsx)(_.a,{style:{fontSize:24},spin:!0})})},y=c(330);t.default=function(){var e=Object(r.c)(),t=Object(s.useRef)(),c=(Object(s.useRef)(),Object(r.d)((function(e){return{currentChat:e.chatReducer.currentChat,currentChatMessages:e.chatReducer.currentChatMessages,userInfo:e.auth.userInfo}}))),o=c.currentChat,i=c.currentChatMessages,l=c.userInfo,d=Object(s.useState)(0),u=Object(n.a)(d,2),j=u[0],b=u[1],f=Object(s.useState)(!1),m=Object(n.a)(f,2),O=m[0],g=m[1],v=Object(s.useState)(!0),x=Object(n.a)(v,2),p=x[0],S=(x[1],Object(s.useState)(!0)),w=Object(n.a)(S,2),C=w[0],N=w[1],_=Object(s.useState)(!1),A=Object(n.a)(_,2),R=A[0],k=A[1];Object(s.useEffect)((function(){a.a.emitGetCurrentChatMessages(o._id)}),[o]),Object(s.useEffect)((function(){var e;C&&(null===(e=t.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})),console.log({currentChatMessages:i})}),[i]),Object(s.useEffect)((function(){console.log({loading:O,hasMore:p})}),[O,p]);var T=function(){k(!0)};return Object(s.useEffect)((function(){console.log({isModalVisible:R})}),[R]),Object(h.jsxs)("div",{className:"pr-3 pl-3 pb-3",onScroll:function(t){console.log({});var c=t.target.scrollTop,n=t.target.scrollHeight,s=t.target.clientHeight;0===c&&(console.log("Loading more..."),g(!0),a.a.emitLoadMoreMessages(o._id,{startPage:j+1,docsPerPage:20}),a.a.onLoadMoreMessages((function(t){var c;console.log(t),g(!1),b(j+1),(null===(c=t.payload)||void 0===c?void 0:c.length)>0&&e(t)})),N(!1)),N(n-c===s)},style:{overflow:"auto",height:"100%"},children:[O&&Object(h.jsx)(I,{}),i.map((function(e,t){var c=e,n=i[t-1],s=i[t+1],a=!0,r=!0,d=!0,u=!1,j=!1,b=c.sender._id===l._id;if(n){var f=n.sender._id===c.sender._id,m=new Date(c.createdAt)-new Date(n.createdAt);f&&m<36e5&&(a=!1),m<36e5&&(d=!1)}if(s){var O=s.sender._id==c.sender._id,g=new Date(s.createdAt)-new Date(c.createdAt);O&&g<36e5&&(r=!1)}return e.repliesTo&&(u=!0),!b&&o.members.length>2&&(j=!0),Object(h.jsx)(M,{isSender:b,startSequence:a,endSequence:r,messageInfo:e,showTimestamp:d,showReply:u,showAvatar:j,showModal:T},t)})),Object(h.jsx)("div",{ref:t}),Object(h.jsxs)(y.a,{title:"Basic Modal",visible:R,onOk:function(){k(!1),console.log("ok")},onCancel:function(){k(!1),console.log("cancel")},children:[Object(h.jsx)("p",{children:"Some contents..."}),Object(h.jsx)("p",{children:"Some contents..."}),Object(h.jsx)("p",{children:"Some contents..."})]})]})}}}]);
//# sourceMappingURL=8.c5e59fd4.chunk.js.map